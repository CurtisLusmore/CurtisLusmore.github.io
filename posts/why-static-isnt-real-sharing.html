<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Why Static Isn’t Real Sharing | lusmo.re</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/layout.css">
    <script src="/js/main.js" defer></script>
  </head>
  <body>
    <article>
      <header>
        <h1>Why Static Isn’t Real Sharing</h1>
      </header>
      <section>
        <p>
          The static keyword has origins as far back as C, and has carried
          across to C++, Java and C#, among others—although its meaning has
          changed a bit along the way. In C# and Java, one of the common uses
          is for class-level sharing of members. Static members don’t belong to
          any instance, and can only be accessed directly from the class or
          from another definition in the same class.
        </p>
        <p>
          And this is all well and good for sharing within a class, but the
          problem is that it doesn’t play well with inheritance, because static
          members cannot be overridden. And inheritance is another common
          method of achieving code sharing. Consider the following snippet,
          which shows how one might hope to override static members in C#.
        </p>
        <pre class="csharp">
public class Base
{
    public static virtual string Value => "Base";
    public static virtual void Display() =>
        Console.WriteLine(Value);
}

public class Sub1 : Base
{
    public static override string Value => "Sub1";
}

public class Sub2 : Base
{
    public static override void Display() =>
        Console.WriteLine($">>> {Value}");
}

new Sub1().Display(); // Sub1

new Sub2().Display(); // >>> Base
</pre>
          <p>
            We would like to be able to override one or both of the
            <code>Value</code> and <code>Display</code> members, but
            unfortunately this won’t compile because static members can’t be
            virtual. Python, on the other hand, got this exactly right—thanks
            to the <code>classmethod</code> decorator.
          </p>
          <pre class="csharp">
class Base:
    value = 'base'
    @classmethod
    def display(cls):
        print(cls.vlaue)

class Sub1(Base):
    value = 'Sub1'

class Sub2(Base):
    @classmethod
    def display(cls):
        print('>>>', cls.value)

Sub1().display() # Sub1

Sub2().display() # >>> Base
          </pre>
          <p>
            So how come Python can do this but C# can’t? Notice that we used
            the <code>classmethod</code> decorator, not the
            <code>staticmethod</code> decorator. The <code>classmethod</code>
            decorator benefits from the fact that it is passed a reference to
            the class, whereas in the case of the staticmethod decorator you
            need to hard-code it into source. This distinction really
            highlights the real meaning of the word static—the static of static
            analysis, static type checking, static libraries, and static memory
            allocation. Static as in not dynamic, known before run-time, often
            at compile-time.
          </p>
          <p>
            The reason why static members can’t be overridden is because doing
            so requires knowing at run-time which override to use, which goes
            against the definition of the word static. Even in a language like
            Python without compilation, the concept of static still exists and
            still has the same restrictions.
          </p>
          <p>
            So if we want to get truly shareable members, both horizontally
            across members of a class and vertically across a type hierarchy,
            we are going to need another solution.
        </p>
      </section>
      <footer>
        <p>
          Posted by Curtis Lusmore on
          <time datetime="2016-04-08">8 April 2016</time>.
        </p>
        <p>
          Thoughts? Comments?
          <a target="_blank" href="mailto:curtis@lusmo.re?subject=Why%20Static%20Isn't%20Real%20Sharing">
            <svg aria-hidden="true" data-prefix="fas" data-icon="envelope-open" class="icon svg-inline--fa fa-envelope-open fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M512 464c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V200.724a48 48 0 0 1 18.387-37.776c24.913-19.529 45.501-35.365 164.2-121.511C199.412 29.17 232.797-.347 256 .003c23.198-.354 56.596 29.172 73.413 41.433 118.687 86.137 139.303 101.995 164.2 121.512A48 48 0 0 1 512 200.724V464zm-65.666-196.605c-2.563-3.728-7.7-4.595-11.339-1.907-22.845 16.873-55.462 40.705-105.582 77.079-16.825 12.266-50.21 41.781-73.413 41.43-23.211.344-56.559-29.143-73.413-41.43-50.114-36.37-82.734-60.204-105.582-77.079-3.639-2.688-8.776-1.821-11.339 1.907l-9.072 13.196a7.998 7.998 0 0 0 1.839 10.967c22.887 16.899 55.454 40.69 105.303 76.868 20.274 14.781 56.524 47.813 92.264 47.573 35.724.242 71.961-32.771 92.263-47.573 49.85-36.179 82.418-59.97 105.303-76.868a7.998 7.998 0 0 0 1.839-10.967l-9.071-13.196z"></path></svg>
            Email the author.</a>
        </p>
      </footer>
    </article>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/contact">Contact</a></li>
        <li><a href="/posts">Posts</a></li>
        <li><a href="/projects">Projects</a></li>
        <li><a href="/reading-list">Reading List</a></li>
        <li><a href="/resume">Résumé</a></li>
        <li><a href="/rss.xml">RSS</a></li>
        <li><a id="theme-switch" style="display: none;">Theme</a></li>
      </ul>
    </nav>
  </body>
</html>